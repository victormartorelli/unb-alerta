{% extends "base.html"%}
{% load staticfiles %}
{% block content %}
{% load crispy_forms_tags %}

<style type="text/css">
  #map {
    width: 90% !important;
    height:550px !important;
    margin-left:5% !important;
    margin-top:2% !important;
    overflow: visible !important;
    border : 3px solid rgba(211,211,211,0.4);
  }
</style>

<script src="{% static 'js/markerclusterers.js' %}"></script>

<script async defer
      src="https://maps.googleapis.com/maps/api/js?callback=initMap&libraries=geometry">
</script>


<script type="text/javascript">
  var map;
  //var pontos = [];
  var pontos = { //lat:null, lng:null };
  0: {lat: -15.765230, lng: -47.868261},
  1: {lat: -15.766304, lng: -47.867874},
  2: {lat: -15.765023, lng: -47.867832},
  3: {lat: -15.765602, lng: -47.871222},
  4: {lat: -15.764487, lng: -47.871522},
  5: {lat: -15.764776, lng: -47.871436}
  }
  
  
  
  for (var i = 0; i < {{array_lat}}.length; i++) {
    pontos[i].lat = ({{array_lat}}[i]);
    pontos[i].lng = ({{array_long}}[i]);
  };
  console.log({{numero_res}});
  /*
  console.log({{array_lat}})
  foreach(var elem in {{array_lat}}.length; i++) {
    ponto.lat = {{array_lat}}[i];
    ponto.lng = {{array_long}}[i];
    pontos.append(ponto);
  };
  console.log(pontos);*/

  function initMap() {
    
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: -15.763606, lng: -47.869636},
      zoom: 17,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    
    var markers = [];
    for (i=0; i < {{numero_res}}; i++){
      var marker = new google.maps.Marker({
        position: pontos[i],
        map: map,
      });
      console.log(typeof(pontos[i]));
      console.log(typeof(marker.position));
      markers.push(marker);
    }
    
    var options = {
      imagePath: '../../static/images/m'
    };
    
    var markerCluster = new MarkerClusterer(map, markers, options);
}
</script>


<div id = "fundo">
  <div class="container">
    <div class="row vertical-offset-100">
      <div class="col-md-10 col-md-offset-1">
        <div class="panel panel-primary">
          <nav class="navfilter">
            <div class="container-fluid" >
              {% crispy filter.form %}
            </div>
          </nav>

          <div class="panel-heading" style="text-align:center">
            <h1>Mapa com estatisticas</h1>
          </div>

          <div class="panel-body">
            <div class="form-group">
              <font color="red">
              <b><div id="resultado" style="text-align:center; color:#4E6c24;"></div></b>
              <div id="map" >
            </div>

          </div>

        </div>
      </nav>
    </div>
  </div>
</div>


{% endblock %}
